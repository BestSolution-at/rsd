// Generated by RSD - Do not modify
package dev.rsdlang.sample.server.rest;

import java.io.IOException;
import java.io.OutputStream;

import jakarta.ws.rs.core.MediaType;
import jakarta.ws.rs.core.Response;
import jakarta.ws.rs.core.StreamingOutput;
import jakarta.ws.rs.WebApplicationException;

import dev.rsdlang.sample.server.rest.model._JsonUtils;
import dev.rsdlang.sample.server.service.model.RSDBlob;
import dev.rsdlang.sample.server.service.model.RSDFile;
import dev.rsdlang.sample.server.service.RSDException;

public class _RestUtils {
	public static Response toResponse(int status, RSDException e) {
		if (e instanceof RSDException.RSDStructuredDataException s) {
			return Response.status(status)
					.header("X-RSD-Error-Type", e.type)
					.header("X-RSD-Error-Message", e.getMessage())
					.entity(_JsonUtils.toJsonString(s.data, false)).build();
		}
		return Response.status(status)
				.header("X-RSD-Error-Type", e.type)
				.header("X-RSD-Error-Message", e.getMessage())
				.entity(_JsonUtils.encodeAsJsonString(e.getMessage())).build();
	}
	public static Response.ResponseBuilder toStreamResponse(int status, RSDBlob blob) {
		class FileStreamingOutput implements StreamingOutput {
			@Override
			public void write(OutputStream output) throws IOException, WebApplicationException {
				blob.stream().transferTo(output);
			}
		}
		var mediaType = blob.mimeType().map(MediaType::valueOf).orElse(MediaType.APPLICATION_OCTET_STREAM_TYPE);
		var builder = Response.status(status).entity(new FileStreamingOutput()).type(mediaType);
		if (blob instanceof RSDFile f) {
			var fileName = f.filename().replace("\"", "");
			builder = builder.header("Content-Disposition", "attachment; filename=\"" + fileName + "\"");
		}
		return builder;
	}
}
